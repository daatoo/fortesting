name: Update Theneo Documentation

on:
  pull_request:
    branches: [ "main" ]
  push:
    branches: [ "main" ]

jobs:
  update-openapi:
    name: Update Theneo Documentation (OpenAPI)
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "18"

      - name: Update Documentation on Theneo (OpenAPI)
        uses: Theneo-Inc/api-documentation@1.8.0
        with:
          FILE_PATH: openapi-v2.yaml
          PROJECT_SLUG: bigreal
          VERSION_SLUG: v2
          WORKSPACE_SLUG: test-21
          SECRET: ${{ secrets.THENEO_SECRET }}

          # behavior:
          AUTO_PUBLISH: true
          IMPORT_OPTION: endpoints

          # optional merge strategies (used mainly with merge import option)
          PARAMETER_DESCRIPTION_MERGE_STRATEGY: keep_new
          SECTION_DESCRIPTION_MERGE_STRATEGY: keep_old

          # optional
          INCLUDE_GITHUB_METADATA: true

  update-markdown:
    name: Update Theneo Documentation (Markdown)
    runs-on: ubuntu-latest
    needs: update-openapi

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "18"

      - name: Install Theneo CLI
        run: npm install -g @theneo/cli@latest

      - name: Login to Theneo CLI
        env:
          THENEO_SECRET: ${{ secrets.THENEO_SECRET }}
        run: |
          theneo login --secret "$THENEO_SECRET"

      - name: Import Markdown project directory into Theneo
        run: |
          theneo import \
            --project bigreal \
            --workspace test-21 \
            --dir ./theneo-markdown
